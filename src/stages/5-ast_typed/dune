(rule
  (targets generated_ast_combined.ml)
  (deps ast.ml ../common/enums.ml)
  (action (with-stdout-to generated_ast_combined.ml (run sh -c "cat ../common/enums.ml ast.ml | grep -v '^(\\*adt_generator_ignore\\*)'")))
  (mode (promote (until-clean) (only *)))
)

(rule
  (targets generated_fold.ml generated_map.ml generated_o.ml)
  (deps ../adt_generator/generator.raku generated_ast_combined.ml)
  (action (run perl6 ../adt_generator/generator.raku generated_ast_combined.ml Generated_o generated_o.ml generated_fold.ml generated_map.ml))
  (mode (promote (until-clean) (only *)))
)

(library
  (name ast_typed)
  (public_name ligo.ast_typed)
  (libraries
    simple-utils
    tezos-utils
    ast_core ; Is that a good idea?
    stage_common
    adt_generator
    UnionFind
  )
  (preprocess
    (pps ppx_let bisect_ppx --conditional)
  )
;;  (modules_without_implementation generated_fold_x)
  (flags (:standard -open Simple_utils))
)
